<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">

<head>
    <title>Building a Swarm Cluster in Local Machine with CoreOS - Nehal Hasnayeen</title><meta name="gridsome:hash" content="56127ce9992a440c088ebef11f505a4ddfbb2bf3"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.9"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.cb378d4.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.cb378d4.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.cb378d4.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.cb378d4.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.cb378d4.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.cb378d4.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.cb378d4.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.cb378d4.png"><link rel="preload" href="/assets/css/0.styles.6486d7fe.css" as="style"><link rel="preload" href="/assets/js/app.48004383.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--blog-post-vue.bfc314e2.js" as="script"><link rel="prefetch" href="/assets/js/15.a656f400.js"><link rel="prefetch" href="/assets/js/16.a196d526.js"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.e05b1ca7.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.74e7d5ba.js"><link rel="prefetch" href="/assets/js/page--src--pages--blog-vue.0fcfe624.js"><link rel="prefetch" href="/assets/js/page--src--pages--bn--eli5-vue.51608fe1.js"><link rel="prefetch" href="/assets/js/page--src--pages--contacts-vue.64b029f3.js"><link rel="prefetch" href="/assets/js/page--src--pages--credits-vue.962028af.js"><link rel="prefetch" href="/assets/js/page--src--pages--hire-me-vue.b4f616ec.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.ebd1cf71.js"><link rel="prefetch" href="/assets/js/page--src--pages--projects-vue.0d80dd3b.js"><link rel="prefetch" href="/assets/js/page--src--pages--reading-vue.7db27c6a.js"><link rel="prefetch" href="/assets/js/page--src--templates--eli5-post-vue.2b42ab50.js"><link rel="prefetch" href="/assets/js/page--src--templates--now-page-vue.c92fe8be.js"><link rel="stylesheet" href="/assets/css/0.styles.6486d7fe.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
</head>

<body class="font-display overflow-x-hidden bg-indigo-100 text-gray-800 " data-vue-tag="%7B%22class%22:%7B%22ssr%22:%22font-display%20overflow-x-hidden%20bg-indigo-100%20text-gray-800%20%22%7D%7D">

    <script>
        // Borrowed from gridsome.org
        (function () {
            window.__onThemeChange = function () { };
            function setTheme(newTheme) {
                window.__theme = newTheme;
                preferredTheme = newTheme;
                window.__onThemeChange(newTheme);
            }

            var preferredTheme;
            try {
                preferredTheme = localStorage.getItem('theme');
            } catch (err) { }

            window.__setPreferredTheme = function (newTheme) {
                setTheme(newTheme);
                try {
                    localStorage.setItem('theme', newTheme);
                } catch (err) { }
            }

            var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

            darkQuery.addListener(function (e) {
                window.__setPreferredTheme(e.matches ? 'dark' : 'light');
            });

            setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
        })();
    </script>

    <div data-server-rendered="true" id="app" class="bg-indigo-100 text-gray-800 " data-v-f4dd72bc><div class="flex flex-col min-h-screen max-w-6xl mx-auto"><header class="lg:py-4 lg:px-16 flex justify-between items-center"><div class="overflow-hidden h-16"><a href="/" class="active"><div class="flex items-center"><img alt="logo" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 300 300' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-0'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-0)' width='300' height='300' xlink:href='data:image/svg%2bxml%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAALaElEQVR42u1afZBVZRm/594LbnyIgpIoTUaDoWWgVmAfRiEfCrv3nF1YFkmxUZkcQadRSWpKbQwdTaaUUUIx9t6zgCgQCBGjDX9EYZKfTH7UgJklBYIhH7t7zi6n3%2b89z3vOey%2b7wL27sDt635ln33PP1/s%2b37/nOZtIlEd5lEd5lEd5lMdJHlaZ%2bY/56PtxZDop8wTQQdC8gvMf%2bZGS%2bUFQANpWoutY3VGzqSIEME8E8MJHIW5YRWxSC%2bA%2bEcDWIl3nfLGau7uLUPQGRoGqi7CAUgWwTp7b0Z003x%2b0RzY2Q86lO1EA%2bplx8gzp%2bwXXujywbZaN7QN99iiRvVQL4PiDPPMmqGd3cQHN5OdBh2SDmzrRBfT9Uw3tz%2bhO2jfNfbaxybntuEIpWYDPvFZC1uiSeLBeNuqDvtSGpgpxwGvHof3vGYKt6m7aL3SFc0C7ZbMvt2EB%2br7Jcs%2bjykx69UteevszCcf1EnbOS1ScfrYW6Kmgf8i9z3V3PKCZrTM09oCpsXRFDP%2bTPSoGn1c5p%2beqILDGPfhmymloseycbzmub4285Sn1rj5nDR2YsKy98q6R3RI2X/nozkTvgUPCnaV6qs1ZydTj%2bBNYyfQT/F1x2qDIZCcu2p349r0vpYtY4ly8R7nTBbU/U%2b8fdHEVLKU54YC6bGSyobmGx02J6qVB8mt3bDB981J9MOLah6nZJDYdae/yB17vjefG2q53B96zCLQSLrAW8wrQI7h/Tqa%2bserW3cEAc11YSQrXlRs4uXgPJ3Vg01jclw15yZqG1ujapMf29K9eHlx4w4vBJVOeDkZllhwcYj5b5Tam8cxc0PbqZUFQ90wQXPVb0AaD8LtuXRDUPBkEdrZpPwSxCfffAjrb2ENKM39ShUDmY214KeP4SqU9138H/hxMfipQBE024vyf5PoA0Jba3wTBVBAEFeD3DtCzovkGWgKIDG8HtdauDoJpEAZnaHwPzv0SNEgswNLWQCE47gkWRJUb%2bxwsICULXwD6PbVVtzbUaE3ImAdqhMAOT1mlBMFz71Io1UsPB8LoN0FtNkZ4HuY%2bAvMs0Dq%2bi0KjIOxQENcb91onxRKqxewN5m1ujJsiYzjeBvoRaBzoM6ArQG9Qk3imGdQqwvlp3nvdFsXA2CUf8p397azXrw2BDINAFmBumrIyCOBefM/CQiFkTpQQtHQdMXv8Hu80tGrG94FurMrGQQ6/L6J58x5utnZVaB2wiPcqG5rScg/jQVKOrwa9Avob6O%2bgrSAyPKJgH18EPT95RWQNC0UpFjPDCbUCw9TOAO0ULbwHGq7QDXK4COksnNslG/RBT4PxezFnQWN18Az9tkW/86VrNiE2rAkFRb/nMc4fpnDVe10vLILWzOf9KykE2cP0wpjU%2bWmPedcV03e9e%2biPwtxlwnRPalQ28kO53gyqPFKQIijXN4X6VdB8vPtmzLOpWQqRsUXc5jK5Twlh/EP7ePyCrPPKFb8%2bmIwsNQg6W/N%2bnPPrm5l%2btilzznlLhJEeE7MHIJgoNtw6/XfqeoNcT8FE05y1yes0erTgJXHkXaZGzDl5V1ILAfNEWgFjDF1DW1anYgQj12rzHojjDxiIMNeZpmfcS98eA4GcXhilnTiWRNhfb1wElVKz62smr5eMcp0GQsbeGGR1YB0WWqcSUAyUOpIa7RjsqBer46w3mEFPBHBDG3igPQG2u0am3hfr8mUtT2MOS%2bZPhFmoRb%2brF%2bg5UAuESOG0gIgiM3GaPtLSSgI8SmvLIkFcLVHaE997VszSsnN52gyDnGagnU3YYVyJLAzMKEHWZFvid8WB1QQ9Z4IO6vTLmRhEMhJB1Zl5Vpv1SjN9O%2bvTTHVwuYta52LA/RrozDMFUOz7py8/nDjCrLPNafMeB3ugMrRCHBFImA79azCT7mEWoStI5ng%2bjkd%2bh/xf%2b7ZD6SpsnvP%2bwlSm4ajOEMVZl2/EAl8L%2bFMqCxA4ud5iO3eoXXSnraaN/f6EaVNg8wzNA4VYcvCbmG1kUHlVcvo2FCd9zI0I%2bEhKcaKYqUZxZG7cdv1C96C5W3hG0qZP5Pg/rjF9o1pnP%2bg004xjl2nJC5pkUKdfOb%2bFGII1g85AJWUDA6GNZtUm2q%2bSc6fY4pN2Q0tehwaF0NHiiTVnfVC4znmE0xJUyfhjoJECfNrt/tgNfmR5eq8Zt7kCa70lKfo%2bDdtLygSG%2bc8Rv3rHdpv7hIs3R4vKPaMYD3QUVrBUFs1IAWW7pia9wWBuGM71BbkSUPdqsHMs5ttBp8QMmxgHRFmXdwgdGgL4hZjUltC8W0zrOJVlLPE%2ba3gWKtp0ndA0U7YZvV3v0yCWxu/DNPfheCfoAOuESGOuVxGBGQjxaMWNwXw/0L8JiwUY1cegqVk1bIoeuuLD/HMRwFYTxuJ3D9b5tA6R%2bC5G43ZSqgY146etDyM1mebMTdPFpP4flofmjhG8oriSbe6r4tSqaC8vOlJmmzGkWBygcf9NYqK7dH418T6CEq/dn3H9XpIR0qpp4Xob6D6goVG2qG9iQK0FfRc0gUUMaCk260uQ3dweoJqyIiAIyw%2bkoXWZrjiT8YSYANdu0pbolBIEndjMR%2bC4VaquWcIkg%2bBWLkQXKNDK%2bWSG%2bF2YYkfooUzWO%2bUompxNaxDz/YK2goyZPepV3LFUWhNUGj2/%2bKAlQq0jBhCLnd%2bhLEAIaaCwjUYnZoS4whs0Z/y%2bWZv5VUs1sFH4nRawl9FdLOiP0GAvo1aI0teEJxQDhLKrKdw8C5i/QKe8fKazXh9iB917UAIMkeAhWW%2bWjmWZUusBI9gNJ/KjFThhtCbyej2UtH9btFABIMK5c0CPM0hKJlloVHRRUdSG9RnwOK/4GQq6HbRRmiZEoy6yUw8oQDVJpN22PZNr0sK2FA4pVggabcXtL3%2bS7suRGVxvFau4U8BOWqPCQjNlm1vyPC3ojIg5AxwR4pqQ2skvsKAAfzn7Cwx0OnDK%2bn8N062qUncYHaox2tr0GtVuEYiwOhe3vg24%2bjnp6rzNzchi61U3qKHVEtPWhRHnCklnoxidJdpP0hajNmVWnJoEISJu9Gb8YLWnrM/1QWy0%2btT8bgZfpuL8vqH3vgj7AF2jUAiOWwRsN33HKQAUeNmPqQ2aN/v8xwioi8n8lDDf3yUxI0aTYXss6eRD2q%2bw8qSWyRCfZxGm%2b4uy7n9AT7K7bGSvrxOPiHJ2gs7Nd2e/6Dhg%2bmRSV1mVS5ot3ZISza4nVGaRZIeaG4DNjAatJjqjb0qO/vNxrDkTax4i406D8ml%2bOeK7voz5Wif8fvCB6h%2bujYSxCnSJPD9BCTy0BHal%2b3cIE2RQgFAIY%2bq9fJToqrp8swY1ksbof/%2biKXITUXR2vR3EDPIxZA2hqgS1IWK6rDDvBL1csyLUMplk670dIbHxehsDnpFp6BoLdAXLnqWcXyTaT3a4TRZXdWFcGL1kf0I%2bW20jg3ozZEAs421%2b/0NwJHJcSo0Z3xHYyWmkb1N4U%2bXDighys9HmSoWBVblKys7PDLS2H6guNNasDRl%2bS0DYLhFArjD7lN4dLvguaKA8BsCLQd8Bw7NB1%2bH4G2xf6XvGLlQZYm4Ie32fLqG%2bFC1jgPM8vPef8oksY/h0OnP3fwu/Tegga8aMT1LTVAIFrIQRWtGHrDgL99thKzDre%2bcYFZcuiuIvyz4D4EUOvxe6XiWYHwsaDs1GvYZphL46cJnN02WNKpA5%2bf0FUxDfYneIAmZNQKWYFtupozJsmeX3AZWJCoW/rRtfDQxh%2balj1CBJnSI18zN/FRyPIiLQVJVV7nZhzeLDlsm8au9nu%2bh/CmxBiZlco/7OkHREWI4r/q1aZX4ExI63iMnrPh2ZrqPusN2V/1BxwgWc9fI62aGA/biu6Yp/pCiP8iiP8iiP8uj%2b4//jX3SFCt7MOAAAAABJRU5ErkJggg==' /%3e%3c/svg%3e" width="300" data-src="/assets/static/logo.6b65613.ea0a5de.svg" data-srcset="/assets/static/logo.6b65613.ea0a5de.svg 300w" data-sizes="(max-width: 300px) 100vw, 300px" class="w-16 h-16 g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/logo.6b65613.ea0a5de.svg" class="w-16 h-16 g-image g-image--loaded" width="300" alt="logo"></noscript><span class="text-3xl pl-2 text-indigo-600 ">hasnayeen</span></div></a></div><div><div class="pr-2 cursor-pointer lg:hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div><nav class="flex items-center"><div class="hidden lg:flex items-center"><div class="mr-8"><div id="theme-menu" class="font-black text-sm cursor-default px-3 py-1 rounded-full bg-gray-800 text-white ">Light</div><div id="theme-dropdown" class="absolute pt-4 z-30"><div class="w-2 h-2 mt-3 ml-8 bg-indigo-600 absolute top-0 arrow"></div><div class="bg-indigo-600 rounded-lg shadow py-2 flex flex-col w-28"><div class="cursor-pointer font-semibold px-4 py-2 text-white hover:text-indigo-600 hover:bg-white">Light</div><div class="cursor-pointer font-semibold px-4 py-2 text-white hover:text-indigo-600 hover:bg-white">Dark</div><div class="cursor-pointer font-semibold px-4 py-2 text-white hover:text-indigo-600 hover:bg-white">Sepia</div><div class="cursor-pointer font-semibold px-4 py-2 text-white hover:text-indigo-600 hover:bg-white">Mountain</div></div></div></div><a href="/about" class="font-semibold mr-8">About</a><div class="mr-8"><div id="more-menu" class="font-semibold cursor-default">More</div><div id="more-dropdown" class="absolute pt-4 -ml-16 z-30"><div class="w-2 h-2 mt-3 ml-20 bg-indigo-600 absolute top-0 arrow"></div><div class="bg-indigo-600 rounded-lg shadow py-4 flex flex-col w-48"><div class="font-semibold px-8 py-2 text-white hover:text-indigo-600 hover:bg-white cursor-pointer">Console</div><a href="/now" class="font-semibold px-8 py-2 text-white hover:text-indigo-600 hover:bg-white">Now</a><a href="/reading" class="font-semibold px-8 py-2 text-white hover:text-indigo-600 hover:bg-white">Reading</a><a href="/projects" class="font-semibold px-8 py-2 text-white hover:text-indigo-600 hover:bg-white">Projects</a><a href="/blog" class="font-semibold px-8 py-2 text-white hover:text-indigo-600 hover:bg-white">Blog</a><div class="border-t px-8 pt-4 pb-2 text-orange-400 text-sm font-semibold">Series</div><a href="/bn/eli5" class="font-semibold px-8 py-2 text-white hover:text-indigo-600 hover:bg-white">Eli5 (বাংলা)</a></div></div></div><a href="/hire-me" class="font-extrabold uppercase bg-indigo-600 text-white px-4 py-2 rounded">Hire Me</a></div><!----></nav></div></header><main class="flex-grow pt-8 mx-4 md:mx-16"><!----><div data-v-f4dd72bc><div class="max-w-4xl container px-4 lg:px-24 py-8 lg:py-16 rounded-lg shadow-xl bg-white text-gray-800 " data-v-f4dd72bc><div class="text-center" data-v-f4dd72bc><span class="border-b border-indigo-600 pb-1" data-v-f4dd72bc>
          May 29, 2017
        </span></div><div class="text-center pb-4 pt-1" data-v-f4dd72bc><span data-v-f4dd72bc>
          2 min read
        </span></div><h1 class="text-2xl md:text-4xl pb-4 text-center text-indigo-600 " data-v-f4dd72bc>Building a Swarm Cluster in Local Machine with CoreOS</h1><div class="md:text-lg leading-relaxed blog" data-v-f4dd72bc><p>So last week I built a cluster on my local machine with docker swarm to get a taste of clustering. I used CoreOS as operating system on all the nodes as CoreOS is a container specific os. CoreOS also has several tools themselves for cluster orchestration. In this post I’ll show you how I made the cluster on vagrant machines.</p>
<p>First of all you should have <a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="nofollow noopener noreferrer">VirtualBox</a> or <a href="https://my.vmware.com/web/vmware/downloads" target="_blank" rel="nofollow noopener noreferrer">VMware</a> to run virtual machine on your host machine and you’ll also need <a href="https://www.vagrantup.com/downloads.html" target="_blank" rel="nofollow noopener noreferrer">Vagrant</a> for provisioning vm. VirtualBox should be running before starting our cluster. First we’ll pull CoreOS vagrant image, enter into a directory and clone the image</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">git</span> clone <span class="token punctuation">[</span>https://github.com/coreos/coreos-vagrant.git<span class="token punctuation">]</span><span class="token punctuation">(</span>https://github.com/coreos/coreos-vagrant.git<span class="token punctuation">)</span> coreos
$ <span class="token builtin class-name">cd</span> coreos</code></pre>
<p>Our cluster will have 1 master node and 3 worker node, so we need to run 4 vm. Open the Vagrantfile and find <code class="language-text">$num_instances</code> and makes it value 4. All the machine is configured to have 1GB of memory, so if you want to increase or decrease the memory change the value of <code class="language-text">vm_memory</code> variables.</p>
<p>Now start all the vm</p>
<pre class="language-bash"><code class="language-bash">$ vagrant up</code></pre>
<p>After sometimes all the vm will be started, check all the machine are running by below command</p>
<pre class="language-bash"><code class="language-bash">$ vagrant status</code></pre>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*89e2LQOjSxbCaaJxoKOudg.png" alt="All 4 machine are running"></p>
<p>Now we’ll ssh into the first machine and start our swarm cluster</p>
<pre class="language-bash"><code class="language-bash">$ vagrant <span class="token function">ssh</span> core-01 -- -A</code></pre>
<p>To initialize the cluster we need the ip address of our machine. Run following command within the vm</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">ip</span> addr show</code></pre>
<p>It’ll show a bunch of network related information. The information we’re interested are the ip address of eth1 interface.</p>
<p><img src="https://cdn-images-1.medium.com/max/2370/1*tt-qdwdl7FvaH-qpx-WPmA.png" alt="Finding IP of our machine"></p>
<p>Now we’ll start the cluster, run the following command</p>
<pre class="language-bash"><code class="language-bash">$ docker swarm init --advertise-addr node_ip_address</code></pre>
<p><code class="language-text">--advertise-addr</code> is used to tell docker swarm which ip address other node should use to join the cluster.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*AXHsGDSvTTq-gtcAdeWTEA.png" alt="Initialize swarm cluster"></p>
<p>So the command started the cluster and made the current machine the manager. You can see it also printed a token which other will use to join the cluster. You should keep this token secret.</p>
<p>Now let’s add a worker node to the cluster. First ssh into the second vm</p>
<pre class="language-bash"><code class="language-bash">$ vagrant <span class="token function">ssh</span> core-02 -- -A</code></pre>
<p>And within the vm run following command</p>
<pre class="language-bash"><code class="language-bash">$ docker swarm <span class="token function">join</span> --token TOKEN manager_node_ip:2377</code></pre>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*HLA800M7G8pwuoVZu9UvaQ.png" alt="Attaching a worker node to the cluster"></p>
<p>We can add the other vm as worker node in same way</p>
<p><img src="https://cdn-images-1.medium.com/max/2650/1*T9FFEV2PcDgl2ApB3k8f0g.png" alt="Adding 3 worker node to the cluster"></p>
<p>Now in the manager node we can see how many nodes are running by following command</p>
<pre class="language-bash"><code class="language-bash">$ docker node <span class="token function">ls</span></code></pre>
<p><img src="https://cdn-images-1.medium.com/max/2614/1*vX2-NWoAohES4BmPPvJg2Q.png" alt="List all the nodes"></p>
<p>We can see 4 nodes are running currently, three of them as worker and a manger node. That means we have successfully started a swarm cluster of 4 nodes on our local machine.</p>
<p>Hopefully this was helpful. Happy Coding!</p>
</div></div><div class="rounded-lg shadow-xl mt-16 mx-auto px-4 lg:px-24 py-8 lg:py-16 max-w-4xl bg-white text-gray-800 " data-v-f4dd72bc><div data-v-f4dd72bc><div class="text-xl font-semibold" data-v-f4dd72bc>
          Comments:
        </div><div data-v-f4dd72bc>
          If you found any error or have any suggestion let me know in the comments.
        </div></div><script src="https://utteranc.es/client.js" repo="Hasnayeen/hasnayeen.github.io" issue-term="title" label="comments" theme="github-light" crossorigin="anonymous" async="async" data-v-f4dd72bc></script></div></div></main><footer class="mt-16 py-4 px-4 lg:px-16 flex flex-col lg:flex-row-reverse lg:bg-transparent justify-between bg-indigo-100 text-gray-800 "><div><span class="font-semibold mr-12 hidden md:inline cursor-pointer">Console</span><a href="/credits" class="font-semibold mr-12">Credits</a><a href="/contacts" class="font-semibold">Contacts</a></div><div class="text-sm lg:text-base text-orange-600 ">
        Copyright © 2019 hasnayeen.dev. All rights reserved.
      </div></footer></div></div>
    <script>window.__INITIAL_STATE__={"data":{"blogPost":{"id":"d1106e1e0feec8f82d0d95e15096418f","title":"Building a Swarm Cluster in Local Machine with CoreOS","date":"May 29, 2017","content":"\u003Cp\u003ESo last week I built a cluster on my local machine with docker swarm to get a taste of clustering. I used CoreOS as operating system on all the nodes as CoreOS is a container specific os. CoreOS also has several tools themselves for cluster orchestration. In this post I’ll show you how I made the cluster on vagrant machines.\u003C\u002Fp\u003E\n\u003Cp\u003EFirst of all you should have \u003Ca href=\"https:\u002F\u002Fwww.virtualbox.org\u002Fwiki\u002FDownloads\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EVirtualBox\u003C\u002Fa\u003E or \u003Ca href=\"https:\u002F\u002Fmy.vmware.com\u002Fweb\u002Fvmware\u002Fdownloads\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EVMware\u003C\u002Fa\u003E to run virtual machine on your host machine and you’ll also need \u003Ca href=\"https:\u002F\u002Fwww.vagrantup.com\u002Fdownloads.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EVagrant\u003C\u002Fa\u003E for provisioning vm. VirtualBox should be running before starting our cluster. First we’ll pull CoreOS vagrant image, enter into a directory and clone the image\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E$ \u003Cspan class=\"token function\"\u003Egit\u003C\u002Fspan\u003E clone \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003Ehttps:\u002F\u002Fgithub.com\u002Fcoreos\u002Fcoreos-vagrant.git\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ehttps:\u002F\u002Fgithub.com\u002Fcoreos\u002Fcoreos-vagrant.git\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E coreos\n$ \u003Cspan class=\"token builtin class-name\"\u003Ecd\u003C\u002Fspan\u003E coreos\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EOur cluster will have 1 master node and 3 worker node, so we need to run 4 vm. Open the Vagrantfile and find \u003Ccode class=\"language-text\"\u003E$num_instances\u003C\u002Fcode\u003E and makes it value 4. All the machine is configured to have 1GB of memory, so if you want to increase or decrease the memory change the value of \u003Ccode class=\"language-text\"\u003Evm_memory\u003C\u002Fcode\u003E variables.\u003C\u002Fp\u003E\n\u003Cp\u003ENow start all the vm\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E$ vagrant up\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EAfter sometimes all the vm will be started, check all the machine are running by below command\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E$ vagrant status\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F2000\u002F1*89e2LQOjSxbCaaJxoKOudg.png\" alt=\"All 4 machine are running\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ENow we’ll ssh into the first machine and start our swarm cluster\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E$ vagrant \u003Cspan class=\"token function\"\u003Essh\u003C\u002Fspan\u003E core-01 -- -A\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003ETo initialize the cluster we need the ip address of our machine. Run following command within the vm\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E$ \u003Cspan class=\"token function\"\u003Eip\u003C\u002Fspan\u003E addr show\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EIt’ll show a bunch of network related information. The information we’re interested are the ip address of eth1 interface.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F2370\u002F1*tt-qdwdl7FvaH-qpx-WPmA.png\" alt=\"Finding IP of our machine\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ENow we’ll start the cluster, run the following command\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E$ docker swarm init --advertise-addr node_ip_address\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Ccode class=\"language-text\"\u003E--advertise-addr\u003C\u002Fcode\u003E is used to tell docker swarm which ip address other node should use to join the cluster.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F2000\u002F1*AXHsGDSvTTq-gtcAdeWTEA.png\" alt=\"Initialize swarm cluster\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ESo the command started the cluster and made the current machine the manager. You can see it also printed a token which other will use to join the cluster. You should keep this token secret.\u003C\u002Fp\u003E\n\u003Cp\u003ENow let’s add a worker node to the cluster. First ssh into the second vm\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E$ vagrant \u003Cspan class=\"token function\"\u003Essh\u003C\u002Fspan\u003E core-02 -- -A\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EAnd within the vm run following command\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E$ docker swarm \u003Cspan class=\"token function\"\u003Ejoin\u003C\u002Fspan\u003E --token TOKEN manager_node_ip:2377\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F2000\u002F1*HLA800M7G8pwuoVZu9UvaQ.png\" alt=\"Attaching a worker node to the cluster\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EWe can add the other vm as worker node in same way\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F2650\u002F1*T9FFEV2PcDgl2ApB3k8f0g.png\" alt=\"Adding 3 worker node to the cluster\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ENow in the manager node we can see how many nodes are running by following command\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E$ docker node \u003Cspan class=\"token function\"\u003Els\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F2614\u002F1*vX2-NWoAohES4BmPPvJg2Q.png\" alt=\"List all the nodes\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EWe can see 4 nodes are running currently, three of them as worker and a manger node. That means we have successfully started a swarm cluster of 4 nodes on our local machine.\u003C\u002Fp\u003E\n\u003Cp\u003EHopefully this was helpful. Happy Coding!\u003C\u002Fp\u003E\n","timeToRead":2}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.48004383.js" defer></script><script src="/assets/js/page--src--templates--blog-post-vue.bfc314e2.js" defer></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-61716953-3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-61716953-3');
    </script>
</body>

</html>